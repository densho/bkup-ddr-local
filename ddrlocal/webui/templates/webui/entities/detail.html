{% extends "webui/entities/base.html" %}
{% load thumbnail %}


{% block title %}{{ entity.id }}{% endblock %}

{% block breadcrumbs %}{{ block.super }}
<li class="active">{{ entity.id }}</li>
{% endblock breadcrumbs %}



{% block content %}

  <div class="row-fluid">
    <div class="span12">


<h1>{{ entity.id }}</h1>


      <ul class="nav nav-tabs" id="tabs">
        <li><a href="#metadata">Object Metadata</a></li>
        <li><a href="#masters">Master Files</a></li>
        <li><a href="#mezzanines">Mezzanine Files</a></li>
      </ul>
      <div class="tab-content">
        <div class="tab-pane" id="metadata">


<div id="overview">

{% if username %}
{% if entity.locked or collection.locked or collection.repo_behind or collection.repo_conflicted %}
<p>
<a class="btn btn-mini" title="This object is locked"><i class="icon-lock"></i> Edit [locked]</a>
{% if collection.repo_behind %}<span id="edit-alert" class="alert alert-error">Editing is disabled until collection is synced.</span>{% endif %}
{% if collection.repo_conflicted %}<span id="edit-alert" class="alert alert-error">Editing is disabled until merge conflict is resolved.</span>{% endif %}
</p>
{% else %}
<p>
<a class="btn btn-primary btn-mini" href="{% url "webui-entity-edit" repo org cid eid %}"><i class="icon-edit icon-white"></i> Edit</a>
</p>
{% endif %}{# conflicted #}
{% endif %}{#username #}

<dl class="dl-horizontal">
  <dt>Collection</dt>
  <dd><p>
  <a href="{{ collection.url }}">{{ collection.id }}: {% if collection.title %}{{ collection.title }}{% endif %}</a>
  </p></dd>
{% for lv in entity.labels_values %}
  {% if lv.value %}<dt>{{ lv.label }}</dt><dd>{{ lv.value|safe|linebreaks }}</dd>{% endif %}
{% endfor %}
</dl>

</div><!-- #mets -->


        </div><!-- .tab-content #metadata -->
        <div class="tab-pane" id="masters">

{% if username %}
{% if entity.locked or collection.locked or collection.repo_behind or collection.repo_conflicted %}
<p>
<a class="btn btn-mini" href="{% url "webui-file-browse-master" repo org cid eid %}"><i class="icon-plus"></i> Add a file</a>
<!--
or <a class="btn btn-mini" href="{% url "webui-file-batch-master" repo org cid eid %}">Add a batch of files</a>
-->
{% if collection.repo_behind %}<span id="edit-alert" class="alert alert-error">Editing is disabled until collection is synced.</span>{% endif %}
{% if collection.repo_conflicted %}<span id="edit-alert" class="alert alert-error">Editing is disabled until merge conflict is resolved.</span>{% endif %}
</p>
{% else %}
<p>
<a class="btn btn-primary btn-mini" href="{% url "webui-file-browse-master" repo org cid eid %}"><i class="icon-plus icon-white"></i> Add a file</a>
<!--
or <a class="btn btn-primary btn-mini" href="{% url "webui-file-batch-master" repo org cid eid %}">Add a batch of files</a>
-->
</p>
{% endif %}{# conflicted #}
{% endif %}{#username #}

{% if entity.files_master %}
<table class="table table-condensed">
  <thead>
	<tr>
{% if username %}
		<th></th>
{% endif %}
		<th>Filename</th>
		<th>Label</th>
	</tr>
  </thead>
  <tbody>	
{% for file in entity.files_master %}
  <tr>

{% if username %}
    <td>
{% if entity.locked or collection.locked or collection.repo_behind or collection.repo_conflicted %}
      <a class="btn btn-mini" href="{{ file.url }}edit/"><i class="icon-edit"></i> Edit</a>
      <a class="btn btn-mini disabled" title="Delete function is not currently available."><i class="icon-remove"></i> Delete</a>
{% else %}
      <a class="btn btn-primary btn-mini" href="{{ file.url }}edit/"><i class="icon-edit icon-white"></i> Edit</a>
      <a class="btn btn-primary btn-mini disabled" title="Delete function is not currently available."><i class="icon-remove icon-white"></i> Delete</a>
{% endif %}{# conflicted #}
    </td>
{% endif %}{#username #}
    <td>
      <a href="{{ file.url }}">{{ file.basename }}</a>
      ({{ file.size|filesizeformat }})
    </td>
    <td>
      {{ file.label }}
    </td>
  </tr>
{% endfor %}
</tbody>
</table>
{% endif %}


        </div><!-- .tab-content #masters -->
        <div class="tab-pane" id="mezzanines">

{% if username %}
{% if entity.locked or collection.locked or collection.repo_behind or collection.repo_conflicted %}
<p>
<a class="btn btn-mini" href="{% url "webui-file-browse-mezzanine" repo org cid eid %}"><i class="icon-plus"></i> Add a file</a>
<!--
or <a class="btn btn-mini" href="{% url "webui-file-batch-mezzanine" repo org cid eid %}">Add a batch of files</a>
-->
{% if collection.repo_behind %}<span id="edit-alert" class="alert alert-error">Editing is disabled until collection is synced.</span>{% endif %}
{% if collection.repo_conflicted %}<span id="edit-alert" class="alert alert-error">Editing is disabled until merge conflict is resolved.</span>{% endif %}
</p>
{% else %}
<p>
<a class="btn btn-primary btn-mini" href="{% url "webui-file-browse-mezzanine" repo org cid eid %}"><i class="icon-plus icon-white"></i> Add a file</a>
<!--
or <a class="btn btn-primary btn-mini" href="{% url "webui-file-batch-mezzanine" repo org cid eid %}">Add a batch of files</a>
-->
</p>
{% endif %}{# conflicted #}
{% endif %}{#username #}

{% if entity.files_mezzanine %}
<table class="table table-condensed">
  <thead>
	<tr>
{% if username %}
		<th></th>
{% endif %}{#username #}
		<th>Filename</th>
		<th>Label</th>
	</tr>
  </thead>
 <tbody> 
{% for file in entity.files_mezzanine %}
  <tr>
{% if username %}
    <td>
{% if entity.locked or collection.locked or collection.repo_behind or collection.repo_conflicted %}
      <a class="btn btn-mini"><i class="icon-edit"></i> Edit</a>
      <a class="btn btn-mini disabled" title="Delete function is not currently available."><i class="icon-remove"></i> Delete</a>
{% else %}
      <a class="btn btn-primary btn-mini" href="{{ file.url }}edit/"><i class="icon-edit icon-white"></i> Edit</a>
      <a class="btn btn-primary btn-mini disabled" title="Delete function is not currently available."><i class="icon-remove icon-white"></i> Delete</a>
{% endif %}{# conflicted #}
    </td>
{% endif %}{#username #}
    <td>
      <a href="{{ file.url }}">{{ file.basename }}</a>
      ({{ file.size|filesizeformat }})
    </td>
    <td>
      {{ file.label }}
    </td>
  </tr>
{% endfor %}
 </tbody>
</table>
{% endif %}


        </div><!-- .tab-content #mezzanines -->
      </div><!-- .tab-content -->

 
    </div><!-- .span12 -->
  </div><!-- .row -->

{% endblock content %}



{% block footer %}{{ block.super }}
{% if unlock_task_id %}
<!-- click to remove entity lock file -->
<div>
  <a id="unlock-unlock" class="muted" href="">unlock</a>
  <span id="unlock-confirm" style="display:none;">
    are you sure?
    <a id="unlock-confirm-yes" href="{% url "webui-entity-unlock" repo org cid eid unlock_task_id %}">yes</a>
    <a id="unlock-confirm-no" href="">no</a>
  </span>
</div>
{% endif %}
{% endblock footer %}




{% block javascript %}{{ block.super }}
<script>
  $(function () {

    /* initialize tabs(?) */
    $('#tabs a').click(function (e) {
      e.preventDefault();
      $(this).tab('show');
    })

    /* show #metadata by default */
    $('#tabs a[href="#metadata"]').tab('show');

  {% if unlock_task_id %}
    /* unlock link */
    $('a#unlock-unlock').click(function() {
      $('span#unlock-confirm').show(); return false;
    });
  {% endif %}

  })
</script>
{% endblock %}
